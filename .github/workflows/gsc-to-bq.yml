name: Daily GSC to BigQuery

# ---------- Trigger ----------
on:
  schedule:
    # هر روز ساعت 02:00 صبح به وقت تهران (UTC+3:30 -> 22:30 UTC روز قبل)
    - cron: '30 22 * * *'
  workflow_dispatch: # این امکان را هم می‌دهد که دستی اجرا کنی

jobs:
  gsc-to-bq:
    runs-on: ubuntu-latest

    env:
      BAMTABRIDSAZAN_GCP_SA_KEY: ${{ secrets.BAMTABRIDSAZAN_GCP_SA_KEY }}

    steps:
      # Checkout repo
      - name: Checkout repository
        uses: actions/checkout@v3

      # Set up Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.10

      # Install dependencies
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install google-api-python-client google-cloud-bigquery pandas

      # Run script
      - name: Run GSC to BigQuery
        run: python gsc-to-bq.py
